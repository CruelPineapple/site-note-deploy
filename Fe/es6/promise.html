<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Promise | 一个云鬼</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="我悲痛欲绝，跳进了家门口的井里">
    
    <link rel="preload" href="/note/assets/css/0.styles.3ff7832e.css" as="style"><link rel="preload" href="/note/assets/js/app.f983845f.js" as="script"><link rel="preload" href="/note/assets/js/2.928e56f7.js" as="script"><link rel="preload" href="/note/assets/js/14.a670e8e1.js" as="script"><link rel="prefetch" href="/note/assets/js/10.10e9bba5.js"><link rel="prefetch" href="/note/assets/js/100.093dd278.js"><link rel="prefetch" href="/note/assets/js/101.00412e22.js"><link rel="prefetch" href="/note/assets/js/102.7970f995.js"><link rel="prefetch" href="/note/assets/js/103.81c3a5c3.js"><link rel="prefetch" href="/note/assets/js/104.7def23bc.js"><link rel="prefetch" href="/note/assets/js/105.71572714.js"><link rel="prefetch" href="/note/assets/js/106.2c2b0343.js"><link rel="prefetch" href="/note/assets/js/107.6da03a34.js"><link rel="prefetch" href="/note/assets/js/108.de5cfc26.js"><link rel="prefetch" href="/note/assets/js/109.06eb18aa.js"><link rel="prefetch" href="/note/assets/js/11.21d5ce58.js"><link rel="prefetch" href="/note/assets/js/110.0961a65c.js"><link rel="prefetch" href="/note/assets/js/111.907335b2.js"><link rel="prefetch" href="/note/assets/js/112.09ad4c61.js"><link rel="prefetch" href="/note/assets/js/113.74a3e12e.js"><link rel="prefetch" href="/note/assets/js/114.a3aefcd6.js"><link rel="prefetch" href="/note/assets/js/115.3961d661.js"><link rel="prefetch" href="/note/assets/js/116.089b979a.js"><link rel="prefetch" href="/note/assets/js/12.d85b2a23.js"><link rel="prefetch" href="/note/assets/js/13.82cfd006.js"><link rel="prefetch" href="/note/assets/js/15.55c6cc83.js"><link rel="prefetch" href="/note/assets/js/16.d793cd34.js"><link rel="prefetch" href="/note/assets/js/17.858f5f11.js"><link rel="prefetch" href="/note/assets/js/18.bdef5aa2.js"><link rel="prefetch" href="/note/assets/js/19.1f0f0ef4.js"><link rel="prefetch" href="/note/assets/js/20.7d58ebce.js"><link rel="prefetch" href="/note/assets/js/21.ca8d12ea.js"><link rel="prefetch" href="/note/assets/js/22.7016d03a.js"><link rel="prefetch" href="/note/assets/js/23.b93d6d0c.js"><link rel="prefetch" href="/note/assets/js/24.21bef6d3.js"><link rel="prefetch" href="/note/assets/js/25.d4a82c7d.js"><link rel="prefetch" href="/note/assets/js/26.312047e3.js"><link rel="prefetch" href="/note/assets/js/27.d94366c6.js"><link rel="prefetch" href="/note/assets/js/28.98d1197d.js"><link rel="prefetch" href="/note/assets/js/29.73c059a0.js"><link rel="prefetch" href="/note/assets/js/3.1d25d7e7.js"><link rel="prefetch" href="/note/assets/js/30.25c0c58b.js"><link rel="prefetch" href="/note/assets/js/31.3777ffa3.js"><link rel="prefetch" href="/note/assets/js/32.ba7d37a3.js"><link rel="prefetch" href="/note/assets/js/33.a8798b43.js"><link rel="prefetch" href="/note/assets/js/34.cc5641c6.js"><link rel="prefetch" href="/note/assets/js/35.b16900ab.js"><link rel="prefetch" href="/note/assets/js/36.7bc8fad0.js"><link rel="prefetch" href="/note/assets/js/37.84ff4ffd.js"><link rel="prefetch" href="/note/assets/js/38.5453e35b.js"><link rel="prefetch" href="/note/assets/js/39.09ccf186.js"><link rel="prefetch" href="/note/assets/js/4.09ee8a39.js"><link rel="prefetch" href="/note/assets/js/40.69391eb2.js"><link rel="prefetch" href="/note/assets/js/41.139c041f.js"><link rel="prefetch" href="/note/assets/js/42.b1dfa639.js"><link rel="prefetch" href="/note/assets/js/43.1bdc7a2c.js"><link rel="prefetch" href="/note/assets/js/44.0b445793.js"><link rel="prefetch" href="/note/assets/js/45.516bc688.js"><link rel="prefetch" href="/note/assets/js/46.0a2796d5.js"><link rel="prefetch" href="/note/assets/js/47.3cef9ff3.js"><link rel="prefetch" href="/note/assets/js/48.8c61e923.js"><link rel="prefetch" href="/note/assets/js/49.c06eff13.js"><link rel="prefetch" href="/note/assets/js/5.18616f39.js"><link rel="prefetch" href="/note/assets/js/50.6fa0e7a1.js"><link rel="prefetch" href="/note/assets/js/51.9ff5dac7.js"><link rel="prefetch" href="/note/assets/js/52.f38322be.js"><link rel="prefetch" href="/note/assets/js/53.2a19a697.js"><link rel="prefetch" href="/note/assets/js/54.68b71cb4.js"><link rel="prefetch" href="/note/assets/js/55.a71ee1d7.js"><link rel="prefetch" href="/note/assets/js/56.a083eff9.js"><link rel="prefetch" href="/note/assets/js/57.4bebd120.js"><link rel="prefetch" href="/note/assets/js/58.ced9b193.js"><link rel="prefetch" href="/note/assets/js/59.1c15d656.js"><link rel="prefetch" href="/note/assets/js/6.498ab014.js"><link rel="prefetch" href="/note/assets/js/60.1669fa9e.js"><link rel="prefetch" href="/note/assets/js/61.79a49711.js"><link rel="prefetch" href="/note/assets/js/62.53fd3e48.js"><link rel="prefetch" href="/note/assets/js/63.ae4350bf.js"><link rel="prefetch" href="/note/assets/js/64.a9647e13.js"><link rel="prefetch" href="/note/assets/js/65.d3352a5c.js"><link rel="prefetch" href="/note/assets/js/66.200eafa2.js"><link rel="prefetch" href="/note/assets/js/67.f2fa88d9.js"><link rel="prefetch" href="/note/assets/js/68.35852ab3.js"><link rel="prefetch" href="/note/assets/js/69.014d551b.js"><link rel="prefetch" href="/note/assets/js/7.6898f26e.js"><link rel="prefetch" href="/note/assets/js/70.c32325b0.js"><link rel="prefetch" href="/note/assets/js/71.9a43c6a1.js"><link rel="prefetch" href="/note/assets/js/72.953e831f.js"><link rel="prefetch" href="/note/assets/js/73.f2c92e73.js"><link rel="prefetch" href="/note/assets/js/74.5a45b5a3.js"><link rel="prefetch" href="/note/assets/js/75.91ee4c84.js"><link rel="prefetch" href="/note/assets/js/76.aa042a21.js"><link rel="prefetch" href="/note/assets/js/77.963a7fbd.js"><link rel="prefetch" href="/note/assets/js/78.421ec7b3.js"><link rel="prefetch" href="/note/assets/js/79.07610256.js"><link rel="prefetch" href="/note/assets/js/8.850337c0.js"><link rel="prefetch" href="/note/assets/js/80.fd094774.js"><link rel="prefetch" href="/note/assets/js/81.1ed99a89.js"><link rel="prefetch" href="/note/assets/js/82.fdd89ae9.js"><link rel="prefetch" href="/note/assets/js/83.e386317a.js"><link rel="prefetch" href="/note/assets/js/84.1f756a94.js"><link rel="prefetch" href="/note/assets/js/85.c7a64996.js"><link rel="prefetch" href="/note/assets/js/86.a38588ab.js"><link rel="prefetch" href="/note/assets/js/87.83713485.js"><link rel="prefetch" href="/note/assets/js/88.c824c6f8.js"><link rel="prefetch" href="/note/assets/js/89.b9098cf7.js"><link rel="prefetch" href="/note/assets/js/9.1889b964.js"><link rel="prefetch" href="/note/assets/js/90.d47dc8ad.js"><link rel="prefetch" href="/note/assets/js/91.4a4a95d8.js"><link rel="prefetch" href="/note/assets/js/92.25b5fde4.js"><link rel="prefetch" href="/note/assets/js/93.c30ee5a8.js"><link rel="prefetch" href="/note/assets/js/94.ed301f60.js"><link rel="prefetch" href="/note/assets/js/95.510ad048.js"><link rel="prefetch" href="/note/assets/js/96.094de9a6.js"><link rel="prefetch" href="/note/assets/js/97.53671372.js"><link rel="prefetch" href="/note/assets/js/98.a905d34f.js"><link rel="prefetch" href="/note/assets/js/99.06c0ed2d.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.3ff7832e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">一个云鬼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/Fe/" class="nav-link router-link-active">
  Note
</a></div><div class="nav-item"><a href="/note/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/CruelPineapple" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/Fe/" class="nav-link router-link-active">
  Note
</a></div><div class="nav-item"><a href="/note/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/CruelPineapple" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ES6</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/Fe/es6/map.html" class="sidebar-link">Map</a></li><li><a href="/note/Fe/es6/set.html" class="sidebar-link">Set</a></li><li><a href="/note/Fe/es6/promise.html" aria-current="page" class="active sidebar-link">Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Fe/es6/promise.html#用法" class="sidebar-link">用法</a></li><li class="sidebar-sub-header"><a href="/note/Fe/es6/promise.html#catch" class="sidebar-link">catch</a></li><li class="sidebar-sub-header"><a href="/note/Fe/es6/promise.html#finally" class="sidebar-link">finally</a></li><li class="sidebar-sub-header"><a href="/note/Fe/es6/promise.html#promise-all" class="sidebar-link">Promise.all</a></li><li class="sidebar-sub-header"><a href="/note/Fe/es6/promise.html#promise-race" class="sidebar-link">Promise.race</a></li><li class="sidebar-sub-header"><a href="/note/Fe/es6/promise.html#promise-allsettled" class="sidebar-link">Promise.allSettled</a></li><li class="sidebar-sub-header"><a href="/note/Fe/es6/promise.html#promise-any" class="sidebar-link">Promise.any</a></li><li class="sidebar-sub-header"><a href="/note/Fe/es6/promise.html#promise-resolve" class="sidebar-link">Promise.resolve</a></li><li class="sidebar-sub-header"><a href="/note/Fe/es6/promise.html#promise-reject" class="sidebar-link">Promise.reject</a></li><li class="sidebar-sub-header"><a href="/note/Fe/es6/promise.html#生成器与promise结合" class="sidebar-link">生成器与promise结合</a></li></ul></li><li><a href="/note/Fe/es6/reflect.html" class="sidebar-link">Reflect</a></li><li><a href="/note/Fe/es6/遍历器.html" class="sidebar-link">遍历器</a></li><li><a href="/note/Fe/es6/生成器.html" class="sidebar-link">生成器</a></li><li><a href="/note/Fe/es6/箭头函数.html" class="sidebar-link">箭头函数</a></li><li><a href="/note/Fe/es6/手promise.html" class="sidebar-link">手写Promise</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>引擎</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>红宝书笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>我不知道的JS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>方法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="promise"><a href="#promise" class="header-anchor">#</a> Promise</h1> <p>理解为一个容器，保存着未来才会结束的事件。Promise对象代表一个异步操作，有三种状态：pending（进行中），fulfilled（已成功），rejected（已失败）。这个状态只能由异步操作的结果决定，并且状态一旦改变，那就不会再变了，任何时候都能得到这个结果。只有两种变化可能：pending变为fulfilled和pending变为rejected，发生变化后，状态就固定了，称为resolved（已定型）。</p> <p>Promise也有一些缺点：它无法取消，一旦新建就会立刻执行，其次，如果不设置回调函数，Promise内部抛出的错误不会反应到外部</p> <h2 id="用法"><a href="#用法" class="header-anchor">#</a> 用法</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... some code</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token comment">/* 异步操作成功 */</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>promise构造函数接收一个函数作为参数，这个函数的两个参数resolve和reject都是js引擎提供的，resolve的作用是将promise对象的状态从未完成变为成功，并将异步操作的结果作为参数传递出去，而reject是从未完成变为失败，同时把错误信息作为参数传递出去。</p> <p>promise实例生成后，可以通过then方法指定resolve和reject状态的回调函数：</p> <div class="language-js extra-class"><pre class="language-js"><code>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// failure</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <p>Promise 新建后会立即执行！</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Promise'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolved.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Promise</span>
<span class="token comment">// Hi!</span>
<span class="token comment">// resolved</span>
</code></pre></div><p>Promise首先输出，因为promise新建之后立即执行了，然后执行了hi，因为then方法指定的回调函数会在当前脚本所有同步任务执行完之后执行，所以resolve最后执行。</p> <h2 id="catch"><a href="#catch" class="header-anchor">#</a> catch</h2> <p>在catch中单独指定处理reject状态的回调函数，和在then中指定是基本相同的，但是它好在可以把then中的错误一起给捕获了。</p> <p>promise对象的错误具有冒泡性质，会一直向后传递知道被catch</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'/post/1.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getJSON</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>commentURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">comments</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// some code</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理前面三个Promise产生的错误</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面有三个promise对象，一个由getJSON产生，两个由then产生。它们之中任何一个抛出错误都会被catch捕获。</p> <h2 id="finally"><a href="#finally" class="header-anchor">#</a> finally</h2> <p>与状态无关的，最后执行的回调</p> <h2 id="promise-all"><a href="#promise-all" class="header-anchor">#</a> Promise.all</h2> <p>将多个promise实例包装成一个新的promise实例，内部所有成员fulfilled，外部实例的状态才会变为fulfilled，此时外部实例的回调参数会接收到一个数组，里面是内部的resolved值。只要内部有一个reject，外部实例就是reject状态，此时第一个reject的内部成员的返回值会传给外部实例的回调。</p> <h2 id="promise-race"><a href="#promise-race" class="header-anchor">#</a> Promise.race</h2> <p>同样是将多个promise包装成一个新的promise，但是和all不同，race只响应第一个发生状态变化的内部实例，将其的返回值传给外部实例的回调。</p> <h2 id="promise-allsettled"><a href="#promise-allsettled" class="header-anchor">#</a> Promise.allSettled</h2> <p>用于希望一组异步操作无论成功或是失败都完成之后再进行下一步。promise all只能用于所有异步操作都成功的情况。这是ES2020引入的。这个方法接收一个成员都为promise实例的数组作为参数，而且包装出来的promise对象，状态只会变为fulfilled。</p> <h2 id="promise-any"><a href="#promise-any" class="header-anchor">#</a> Promise.any</h2> <p>ES2021引入，只要有一个内部实例funfilled，包装实例就会fulfilled，所有内部实例rejected，包装实例才会rejected</p> <h2 id="promise-resolve"><a href="#promise-resolve" class="header-anchor">#</a> Promise.resolve</h2> <p>把现有对象转换为promise对象，它这样工作：</p> <ol><li><p>参数是一个Promise实例：resolve不做任何更改</p></li> <li><p>参数是具有then方法的对象：转换为promise对象，然后执行then方法</p></li> <li><p>参数是没有then方法的对象，或者不是对象：返回一个resolved的promise实例（也就是说它的回调会立刻执行）</p></li> <li><p>没有参数：返回一个resolved的promise对象</p></li></ol> <h2 id="promise-reject"><a href="#promise-reject" class="header-anchor">#</a> Promise.reject</h2> <p>返回一个状态为reject的promise对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 出错了</span>
</code></pre></div><h2 id="生成器与promise结合"><a href="#生成器与promise结合" class="header-anchor">#</a> 生成器与promise结合</h2> <p>使用生成器管理流程，遇到异步操作的时候，通常返回一个promise对象。</p> <p>寄了，看不懂</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getFoo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">g</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">run</span> <span class="token punctuation">(</span><span class="token parameter">generator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> it <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">return</span> result<span class="token punctuation">.</span>value<span class="token punctuation">;</span>

    <span class="token keyword">return</span> result<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">go</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">go</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">go</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">run</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/Fe/es6/set.html" class="prev">
        Set
      </a></span> <span class="next"><a href="/note/Fe/es6/reflect.html">
        Reflect
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.f983845f.js" defer></script><script src="/note/assets/js/2.928e56f7.js" defer></script><script src="/note/assets/js/14.a670e8e1.js" defer></script>
  </body>
</html>
