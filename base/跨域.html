<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>è·¨åŸŸ | ä¸€ä¸ªäº‘é¬¼</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="æˆ‘æ‚²ç—›æ¬²ç»ï¼Œè·³è¿›äº†å®¶é—¨å£çš„äº•é‡Œ">
    
    <link rel="preload" href="/note/assets/css/0.styles.ba1ec7e7.css" as="style"><link rel="preload" href="/note/assets/js/app.e1bd6a40.js" as="script"><link rel="preload" href="/note/assets/js/2.928e56f7.js" as="script"><link rel="preload" href="/note/assets/js/74.2bf5ec9d.js" as="script"><link rel="prefetch" href="/note/assets/js/10.3231d749.js"><link rel="prefetch" href="/note/assets/js/11.10388147.js"><link rel="prefetch" href="/note/assets/js/12.fc9ff348.js"><link rel="prefetch" href="/note/assets/js/13.c265294a.js"><link rel="prefetch" href="/note/assets/js/14.02ac48f3.js"><link rel="prefetch" href="/note/assets/js/15.a1e54ea1.js"><link rel="prefetch" href="/note/assets/js/16.4e515a4f.js"><link rel="prefetch" href="/note/assets/js/17.ecb67a0b.js"><link rel="prefetch" href="/note/assets/js/18.3e184518.js"><link rel="prefetch" href="/note/assets/js/19.63fd4d97.js"><link rel="prefetch" href="/note/assets/js/20.2bd514c5.js"><link rel="prefetch" href="/note/assets/js/21.2a55dadb.js"><link rel="prefetch" href="/note/assets/js/22.4384bda1.js"><link rel="prefetch" href="/note/assets/js/23.748eeeed.js"><link rel="prefetch" href="/note/assets/js/24.8ca73306.js"><link rel="prefetch" href="/note/assets/js/25.17228feb.js"><link rel="prefetch" href="/note/assets/js/26.cacd579a.js"><link rel="prefetch" href="/note/assets/js/27.b7b4c694.js"><link rel="prefetch" href="/note/assets/js/28.5c367749.js"><link rel="prefetch" href="/note/assets/js/29.3ab5f129.js"><link rel="prefetch" href="/note/assets/js/3.4bcdc2c8.js"><link rel="prefetch" href="/note/assets/js/30.96a2efd8.js"><link rel="prefetch" href="/note/assets/js/31.0432987a.js"><link rel="prefetch" href="/note/assets/js/32.cf7dd2d4.js"><link rel="prefetch" href="/note/assets/js/33.7727f226.js"><link rel="prefetch" href="/note/assets/js/34.6006c18f.js"><link rel="prefetch" href="/note/assets/js/35.853d275d.js"><link rel="prefetch" href="/note/assets/js/36.51c96f58.js"><link rel="prefetch" href="/note/assets/js/37.27621e49.js"><link rel="prefetch" href="/note/assets/js/38.785c7f3a.js"><link rel="prefetch" href="/note/assets/js/39.c0907c61.js"><link rel="prefetch" href="/note/assets/js/4.e05c873c.js"><link rel="prefetch" href="/note/assets/js/40.7f9306fc.js"><link rel="prefetch" href="/note/assets/js/41.97b4baaa.js"><link rel="prefetch" href="/note/assets/js/42.58705258.js"><link rel="prefetch" href="/note/assets/js/43.6a8883b8.js"><link rel="prefetch" href="/note/assets/js/44.bd24d91d.js"><link rel="prefetch" href="/note/assets/js/45.bdcdbda1.js"><link rel="prefetch" href="/note/assets/js/46.0a920c8d.js"><link rel="prefetch" href="/note/assets/js/47.98b748fd.js"><link rel="prefetch" href="/note/assets/js/48.def39700.js"><link rel="prefetch" href="/note/assets/js/49.b09cfab4.js"><link rel="prefetch" href="/note/assets/js/5.76fc70b2.js"><link rel="prefetch" href="/note/assets/js/50.fc43bbf9.js"><link rel="prefetch" href="/note/assets/js/51.46e89101.js"><link rel="prefetch" href="/note/assets/js/52.e50764b9.js"><link rel="prefetch" href="/note/assets/js/53.199a1faf.js"><link rel="prefetch" href="/note/assets/js/54.a2b1e336.js"><link rel="prefetch" href="/note/assets/js/55.cfd39c08.js"><link rel="prefetch" href="/note/assets/js/56.95011208.js"><link rel="prefetch" href="/note/assets/js/57.1f45efc4.js"><link rel="prefetch" href="/note/assets/js/58.ec71c443.js"><link rel="prefetch" href="/note/assets/js/59.38c2be5f.js"><link rel="prefetch" href="/note/assets/js/6.498ab014.js"><link rel="prefetch" href="/note/assets/js/60.ac6fdf33.js"><link rel="prefetch" href="/note/assets/js/61.f5929d5b.js"><link rel="prefetch" href="/note/assets/js/62.e994a1a1.js"><link rel="prefetch" href="/note/assets/js/63.75856c15.js"><link rel="prefetch" href="/note/assets/js/64.9a338023.js"><link rel="prefetch" href="/note/assets/js/65.85bb98d8.js"><link rel="prefetch" href="/note/assets/js/66.b91a9077.js"><link rel="prefetch" href="/note/assets/js/67.58f7c3fa.js"><link rel="prefetch" href="/note/assets/js/68.fa2dc56d.js"><link rel="prefetch" href="/note/assets/js/69.d67a88a9.js"><link rel="prefetch" href="/note/assets/js/7.404a00b4.js"><link rel="prefetch" href="/note/assets/js/70.0604103c.js"><link rel="prefetch" href="/note/assets/js/71.0fefb9af.js"><link rel="prefetch" href="/note/assets/js/72.43dfd9c2.js"><link rel="prefetch" href="/note/assets/js/73.37011f9c.js"><link rel="prefetch" href="/note/assets/js/75.c5561734.js"><link rel="prefetch" href="/note/assets/js/76.640b6b09.js"><link rel="prefetch" href="/note/assets/js/77.13eb843d.js"><link rel="prefetch" href="/note/assets/js/78.6b3d9861.js"><link rel="prefetch" href="/note/assets/js/79.67562f9f.js"><link rel="prefetch" href="/note/assets/js/8.a7080b74.js"><link rel="prefetch" href="/note/assets/js/80.ffa58cdc.js"><link rel="prefetch" href="/note/assets/js/81.7b81bbd2.js"><link rel="prefetch" href="/note/assets/js/82.7115ed43.js"><link rel="prefetch" href="/note/assets/js/83.41f35d49.js"><link rel="prefetch" href="/note/assets/js/84.f595d19a.js"><link rel="prefetch" href="/note/assets/js/85.721de3d0.js"><link rel="prefetch" href="/note/assets/js/86.63418583.js"><link rel="prefetch" href="/note/assets/js/87.0ffc51a8.js"><link rel="prefetch" href="/note/assets/js/88.a80fb226.js"><link rel="prefetch" href="/note/assets/js/89.5ec200a5.js"><link rel="prefetch" href="/note/assets/js/9.318d9304.js"><link rel="prefetch" href="/note/assets/js/90.e6491edb.js"><link rel="prefetch" href="/note/assets/js/91.b0ce484f.js"><link rel="prefetch" href="/note/assets/js/92.8187a399.js"><link rel="prefetch" href="/note/assets/js/93.1e2b87af.js"><link rel="prefetch" href="/note/assets/js/94.f19608fc.js"><link rel="prefetch" href="/note/assets/js/95.58078217.js"><link rel="prefetch" href="/note/assets/js/96.9b5293a5.js"><link rel="prefetch" href="/note/assets/js/97.5ac3d518.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.ba1ec7e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">ä¸€ä¸ªäº‘é¬¼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/Fe/" class="nav-link">
  Note
</a></div><div class="nav-item"><a href="/note/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/CruelPineapple" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/Fe/" class="nav-link">
  Note
</a></div><div class="nav-item"><a href="/note/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/CruelPineapple" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>çº¢å®ä¹¦ç¬”è®°</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>åŸºç¡€</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/base/tcpæ‹¥å¡.html" class="sidebar-link">TCPæ‹¥å¡æ§åˆ¶</a></li><li><a href="/note/base/34.html" class="sidebar-link">ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</a></li><li><a href="/note/base/http.html" class="sidebar-link">HTTP</a></li><li><a href="/note/base/httpç¼“å­˜.html" class="sidebar-link">HTTPç¼“å­˜</a></li><li><a href="/note/base/url.html" class="sidebar-link">è¾“å…¥urlå</a></li><li><a href="/note/base/getå’Œpost.html" class="sidebar-link">HTTPæ–¹æ³•</a></li><li><a href="/note/base/è·¨åŸŸ.html" class="active sidebar-link">è·¨åŸŸ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/base/è·¨åŸŸ.html#cors" class="sidebar-link">CORS</a></li><li class="sidebar-sub-header"><a href="/note/base/è·¨åŸŸ.html#jsonpè·¨åŸŸ" class="sidebar-link">JSONPè·¨åŸŸ</a></li><li class="sidebar-sub-header"><a href="/note/base/è·¨åŸŸ.html#document-domain-iframe" class="sidebar-link">document.domain+iframe</a></li><li class="sidebar-sub-header"><a href="/note/base/è·¨åŸŸ.html#location-hash-iframe" class="sidebar-link">location.hash+iframe</a></li><li class="sidebar-sub-header"><a href="/note/base/è·¨åŸŸ.html#window-name-iframe" class="sidebar-link">window.name+iframe</a></li><li class="sidebar-sub-header"><a href="/note/base/è·¨åŸŸ.html#postmessage" class="sidebar-link">postMessage</a></li><li class="sidebar-sub-header"><a href="/note/base/è·¨åŸŸ.html#nginxåå‘ä»£ç†" class="sidebar-link">Nginxåå‘ä»£ç†</a></li><li class="sidebar-sub-header"><a href="/note/base/è·¨åŸŸ.html#nodejsä¸­é—´ä»¶ä»£ç†" class="sidebar-link">Nodejsä¸­é—´ä»¶ä»£ç†</a></li><li class="sidebar-sub-header"><a href="/note/base/è·¨åŸŸ.html#æœ¬åœ°åå‘ä»£ç†" class="sidebar-link">æœ¬åœ°åå‘ä»£ç†</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å¼•æ“</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æˆ‘ä¸çŸ¥é“çš„JS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é¢è¯•</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é¢˜</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ–¹æ³•</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å°ç¨‹åº</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="è·¨åŸŸ"><a href="#è·¨åŸŸ" class="header-anchor">#</a> è·¨åŸŸ</h1> <p>ç®€å•è·¨åŸŸå¯ä»¥ç”¨jsonpï¼Œå¤æ‚çš„corsï¼Œçª—å£ä¹‹é—´çš„jsè·¨åŸŸpostMessageæ¯”è¾ƒå¥½ï¼ˆæ–°apiï¼Œä¸ç”¨æ“ä½œBOMï¼‰ï¼Œæœ¬åœ°å¼€å‘ç¯å¢ƒç”¨åä»£</p> <h2 id="cors"><a href="#cors" class="header-anchor">#</a> CORS</h2> <p>CORSè·¨åŸŸæ–¹æ¡ˆä¸­ï¼Œè¯·æ±‚è¢«åˆ†ä¸ºç®€å•è¯·æ±‚å’Œå¤æ‚è¯·æ±‚ï¼Œå…¶ä¸­å¤æ‚è¯·æ±‚éœ€è¦ä½¿ç”¨optionè¯·æ±‚å…ˆè¿›è¡Œé¢„è¯·æ±‚ï¼Œå› ä¸ºå¤æ‚è¯·æ±‚æ¶‰åŠæœåŠ¡å™¨æ•°æ®çš„æ›´æ”¹ï¼ˆå¦‚putï¼Œdeleteï¼‰æ‰€ä»¥è¦ä½¿ç”¨é¢„è¯·æ±‚è¯¢é—®æœåŠ¡å™¨</p> <p>ç®€å•è¯·æ±‚çš„ç‰¹å¾æ˜¯ï¼šæ–¹æ³•ä¸ºgetï¼Œpostï¼Œheadï¼›ä¸”Content-Typeä¸ºä»¥ä¸‹ä¸‰ç§ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>text/plain
multipart/form-data
application/x-www-form-urlencoded
</code></pre></div><p>åŒæ—¶ä¸å¯ä»¥æœ‰è‡ªå®šä¹‰å¤´éƒ¨å­—æ®µã€‚</p> <p>ä¸æ˜¯ç®€å•è¯·æ±‚çš„éƒ½ç®—å¤æ‚è¯·æ±‚</p> <p>application/jsonç®—æ˜¯å¤æ‚è¯·æ±‚ï¼Œè€Œä¸”axiosé»˜è®¤çš„å¥½åƒå°±æ˜¯è¿™ä¸ªï¼Œå®ƒå°±ä¼šè¢«è®¤ä¸ºæ˜¯å¤æ‚è¯·æ±‚ã€‚<s>çœ‹äº†ä¸€ä¸‹ä¹‹å‰çš„ä¸€ä¸ªé¡¹ç›®çš„postå‘ç°contenttypeæ˜¯jsonè€Œä¸”æ²¡æœ‰é¢„è¯·æ±‚ã€‚ã€‚æƒ³äº†åŠå¤©å‘ç°å®ƒå°±æ²¡è·¨åŸŸï¼Œæ˜¯åŒæºçš„</s></p> <h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="header-anchor">#</a> å®¢æˆ·ç«¯</h3> <p>è·¨åŸŸå‘ç”Ÿåœ¨è¯·æ±‚æºå’Œä¸»æœºåŸŸåä¸åŒçš„æƒ…å†µã€‚è¿™æ—¶å€™å¦‚æœæœåŠ¡ç«¯æ²¡æœ‰å“åº”è‡ªå·±çš„è·¨åŸŸè§„åˆ™ï¼ˆåœ¨å“åº”å¤´éƒ¨é‡Œé¢ï¼‰é‚£è¿™ä¸ªè¯·æ±‚å°±ä¼šè¢«æµè§ˆå™¨é˜»æŒ¡ã€‚</p> <p>å¯¹äºä¸€ä¸ªè¯·æ±‚ï¼Œæµè§ˆå™¨é¦–å…ˆåˆ¤æ–­å®ƒæ˜¯ç®€å•è¯·æ±‚è¿˜æ˜¯å¤æ‚è¯·æ±‚ã€‚</p> <p>å¦‚æœå®ƒæ˜¯ç®€å•è¯·æ±‚ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šè‡ªåŠ¨åœ°ç»™è¿™ä¸ªè¯·æ±‚å¤´éƒ¨åŠ ä¸ŠOriginå­—æ®µï¼Œè¡¨ç¤ºè¯·æ±‚çš„æº</p> <p>å¦‚æœå®ƒæ˜¯å¤æ‚è¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒä¸ä»…ä¼šåœ¨è¯·æ±‚å¤´éƒ¨åŠ ä¸ŠOriginå­—æ®µï¼Œè€Œä¸”ä¼šåœ¨æ­£å¼çš„è¯·æ±‚å‘é€ä¹‹å‰å¢åŠ ä¸€æ¬¡optionsé¢„è¯·æ±‚ã€‚é¢„è¯·æ±‚æœ‰å¦‚ä¸‹å‡ ä¸ªå…³é”®çš„å­—æ®µï¼š</p> <p>Originï¼šå‘ŠçŸ¥æœåŠ¡å™¨è¯·æ±‚æ¥è‡ªå“ªä¸ªåŸŸå</p> <p>Access-Control-Request-Methodï¼šå‘ŠçŸ¥æœåŠ¡å™¨å°†è¦ä½¿ç”¨çš„è¯·æ±‚æ–¹å¼</p> <p>Access-Control-Request-Headersï¼šå‘ŠçŸ¥æœåŠ¡å™¨å°†è¦å‘é€çš„é¢å¤–å¤´éƒ¨å­—æ®µï¼ˆå¦‚æœæ²¡æœ‰è®¾ç½®é¢å¤–å¤´éƒ¨é‚£å°±æ²¡æœ‰è¿™ä¸ªï¼Œä¾‹å¦‚è®¾ç½®äº†content-typeï¼šapplication/jsonï¼Œè¿™ä¸ªå­—æ®µå°±ä¼šå˜æˆï¼šAccess-Control-Request-Headers: content-typeï¼‰</p> <p>å¦‚æœé¢„è¯·æ±‚è¢«æ‹’ç»ï¼ˆ405ï¼‰é‚£ä¹ˆæ­£å¼è¯·æ±‚æ˜¯æ— æ³•å‘é€çš„</p> <h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="header-anchor">#</a> æœåŠ¡ç«¯</h3> <p>è·¨åŸŸæƒ…å†µï¼ŒæœåŠ¡ç«¯å¤„ç†ç®€å•è¯·æ±‚ï¼Œéœ€è¦è¿›è¡Œå¦‚ä¸‹å‡ ä¸ªåˆ¤æ–­ï¼š</p> <ol><li><p>é¦–å…ˆè®¾ç½®å“åº”å¤´éƒ¨å­—æ®µAccess-Control-Allow-Originï¼Œè¿™ä¸ªå­—æ®µçš„å€¼è¡¨ç¤ºäº†å…è®¸è·¨åŸŸè®¿é—®çš„æºï¼Œå¦‚æœæºä¸åœ¨æ­¤å­—æ®µè§„å®šçš„èŒƒå›´å†…æ˜¯ä¸èƒ½è®¿é—®çš„</p></li> <li><p>è®¾ç½®å“åº”å¤´éƒ¨å­—æ®µVaryï¼šOriginï¼ˆå¯é€‰ï¼‰è¯¥å­—æ®µç”¨äºå¤„ç†CDNç¼“å­˜é—®é¢˜ï¼š</p></li></ol> <p>ä¸¾ä¸ªä¾‹å­ï¼šå½“å‰æœåŠ¡å™¨å¯¹<code>http://a.com:8080</code>ä¸<code>http://a.com:8090</code>ä¸¤ä¸ªæºéœ€è¦è¿›è¡Œè·¨åŸŸè¯·æ±‚åšå‡ºå›åº”ï¼Œ
æŒ‰é“ç†è¯´å¯¹<code>http://a.com:8080</code>çš„å“åº”å¤´è®¾ç½®åº”è¯¥æ˜¯<code>Access-Control-Allow-Origin:http://a.com:8080</code>,
å¯¹<code>http://a.com:8090</code>çš„å“åº”å¤´è®¾ç½®åº”è¯¥æ˜¯<code>Access-Control-Allow-Origin:http://a.com:8090</code>ã€‚
ä½†æ˜¯ç”±äºç¼“å­˜ï¼Œ<code>http://a.com:8090</code>çš„å“åº”å¤´è¿”å›çš„<code>Access-Control-Allow-Origin:http://a.com:8080</code>ï¼Œå¯¼è‡´<code>http://a.com:8090</code>çš„è·¨åŸŸè¯·æ±‚å¤±è´¥ã€‚
è¿™æ—¶å€™è®¾ç½®äº†Varyï¼šOriginï¼Œå°±å¯ä»¥ä¸ºä¸åŒæºç¼“å­˜ä¸åŒèµ„æºï¼Œè§£å†³äº†CDNç¼“å­˜é—®é¢˜</p> <ol start="3"><li>è®¾ç½®å“åº”å¤´éƒ¨å­—æ®µAccess-Control-Allow-Credentialsï¼ˆå¯é€‰ï¼‰ï¼Œè¯¥å­—æ®µè¡¨ç¤ºæœåŠ¡å™¨æ˜¯å¦å…è®¸ä½¿ç”¨Cookieã€‚è¿™ä¸ªå­—æ®µçš„å€¼åªæœ‰trueï¼Œæ²¡æœ‰è¿™ä¸ªå­—æ®µå°±è¡¨ç¤ºfalseã€‚å¦å¤–ï¼Œå¦‚æœè®¾ç½®äº†Access-Control-Allow- Originï¼š*ï¼Œé‚£ä¹ˆå°±å¿…é¡»åˆ é™¤Credentialså­—æ®µï¼Œåº”è¯¥æ˜¯ä¸ºäº†å®‰å…¨</li> <li>è®¾ç½®å“åº”å¤´éƒ¨å­—æ®µAccess-Control-Expose-Headersï¼ˆå¯é€‰ï¼‰å¦‚æœæœåŠ¡å™¨é™¤äº†é»˜è®¤å¤´éƒ¨å­—æ®µè¿˜æƒ³æ˜¾ç¤ºå…¶ä»–å¤´éƒ¨ä¿¡æ¯ï¼Œé€šè¿‡æ­¤å­—æ®µè®¾ç½®</li></ol> <p>å¯¹äºéç®€å•è¯·æ±‚ï¼Œé™¤äº†ä¸Šé¢å››ä¸ªæ­¥éª¤ä»¥å¤–ï¼Œç”±äºå“åº”çš„æ˜¯optionsè¯·æ±‚ï¼Œè¿˜ä¼šæœ‰ä»¥ä¸‹å‡ æ­¥ï¼š</p> <ol><li>åˆ¤æ–­è¯·æ±‚å¤´ä¸­æ˜¯å¦æœ‰Access-Control-Request- Methodå­—æ®µï¼Œæ²¡æœ‰çš„è¯ä¼šæ‹’ç»æ­¤æ¬¡è·¨åŸŸ</li> <li>è®¾ç½®å“åº”å¤´éƒ¨å­—æ®µAccess-Control-Allow-Methodsï¼ˆå¯é€‰ï¼‰å‘ŠçŸ¥æµè§ˆå™¨å…è®¸çš„è¯·æ±‚æ–¹å¼</li> <li>è®¾ç½®å“åº”å¤´éƒ¨å­—æ®µAccess-Control-Allow-Methodsï¼ˆå¯é€‰ï¼‰å‘ŠçŸ¥æµè§ˆå™¨å…è®¸çš„å¤´éƒ¨å­—æ®µ</li></ol> <h2 id="jsonpè·¨åŸŸ"><a href="#jsonpè·¨åŸŸ" class="header-anchor">#</a> JSONPè·¨åŸŸ</h2> <p>ç®€å•æ¥è¯´å°±æ˜¯åˆ©ç”¨äº†æ‹¥æœ‰srcå±æ€§çš„æ ‡ç­¾éƒ½å¯ä»¥ä¸å—åŒæºç­–ç•¥çš„å½±å“ï¼Œåœ¨åŠ¨æ€ç”Ÿæˆçš„scriptæ ‡ç­¾ä¸­é€šè¿‡urlå‚æ•°ä¸è·¨åŸŸç«™ç‚¹é€šä¿¡ï¼ŒåŒæ—¶æŒ‡å®šç”¨äºå¤„ç†è¿”å›å€¼çš„å›è°ƒå‡½æ•°ï¼ŒæœåŠ¡ç«¯è¿”å›å›è°ƒå‡½æ•°çš„è°ƒç”¨ï¼Œå¹¶å°†éœ€è¦å“åº”çš„å€¼ä½œä¸ºå›è°ƒçš„å‚æ•°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
script<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/javascript'</span><span class="token punctuation">;</span>
script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://domain.com?user=admin&amp;callback=handleCallback'</span><span class="token punctuation">;</span>
docoment<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleCallback</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æœåŠ¡ç«¯è¿”å›ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>handleCallback({
	&quot;status&quot;: true,
	&quot;user&quot;: &quot;admin&quot;
})
</code></pre></div><p>åç«¯è¿”å›çš„æ—¶å€™éœ€è¦è®¾ç½®å¤´éƒ¨å­—æ®µContent-Type: text/javascript</p> <p>è¿”å›çš„å†…å®¹å°±ä¼šè¢«æ‰§è¡Œã€‚ç›¸å½“äºæµè§ˆå™¨åŠ¨æ€åˆ›å»ºäº†jsæ ‡ç­¾ï¼Œå†…å®¹æ˜¯æœåŠ¡ç«¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œåœ¨ä¼ å›æ•°æ®çš„åŒæ—¶é¡ºä¾¿è°ƒç”¨äº†è®¾ç½®å¥½çš„å¤„ç†å‡½æ•°ã€‚JSONPåªèƒ½æ˜¯getï¼Œå› ä¸ºscriptæ ‡ç­¾çš„srcæœ¬è´¨å°±æ˜¯get</p> <h2 id="document-domain-iframe"><a href="#document-domain-iframe" class="header-anchor">#</a> document.domain+iframe</h2> <p>ä¸ç®—æ˜¯è¯·æ±‚è·¨åŸŸï¼Œåªæ˜¯è®©</p> <p>ç”¨äºä¸»åŸŸç›¸åŒï¼Œå­åŸŸä¸åŒçš„è·¨åŸŸåº”ç”¨åœºæ™¯ï¼Œä¸¤ä¸ªé¡µé¢éƒ½é€šè¿‡å¼ºåˆ¶è®¾ç½®document.doainä¸ºåŸºç¡€ä¸»åŸŸï¼Œå°±å®ç°äº†åŒåŸŸï¼š</p> <p>çˆ¶çª—å£ï¼š</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iframe<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://child.domain.com/b.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    document<span class="token punctuation">.</span>domain <span class="token operator">=</span> <span class="token string">'domain.com'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token string">'admin'</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>å­çª—å£ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span>domain <span class="token operator">=</span> <span class="token string">'domain.com'</span><span class="token punctuation">;</span>
<span class="token comment">// è·å–çˆ¶çª—å£ä¸­å˜é‡</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'get js data from parent ---&gt; '</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="location-hash-iframe"><a href="#location-hash-iframe" class="header-anchor">#</a> location.hash+iframe</h2> <p>ä¸»åŸŸä¸åŒçš„æƒ…å†µå°±ä¸èƒ½ç”¨ä¸Šé¢çš„document.domainæ¥è®¾ç½®ä¸ºåŒåŸŸäº†ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ–°å¢ä¸€ä¸ªé¡µé¢æ¥è·¨åŸŸã€‚</p> <p>aåŸŸä¸båŸŸéœ€è¦è·¨åŸŸé€šä¿¡ï¼Œé€šè¿‡ä¸­é—´é¡µé¢cæ¥å®ç°ï¼Œä¸åŒåŸŸä¹‹é—´é€šè¿‡iframeçš„location.hashä¼ å€¼ï¼ˆå°±æ˜¯locationçš„åé¢ç”¨#è·Ÿä¸Šå‚æ•°ï¼‰ï¼Œç›¸åŒåŸŸä¹‹é—´ç›´æ¥jsè®¿é—®æ¥é€šä¿¡</p> <p>a.htmlï¼šwww.domain1.com/a.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iframe<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.domain2.com/b.html<span class="token punctuation">&quot;</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token style language-css"><span class="token property">display</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å‘b.htmlä¼ hashå€¼</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> iframe<span class="token punctuation">.</span>src <span class="token operator">+</span> <span class="token string">'#user=admin'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// å¼€æ”¾ç»™åŒåŸŸc.htmlçš„å›è°ƒæ–¹æ³•</span>
    <span class="token keyword">function</span> <span class="token function">onCallback</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'data from c.html ---&gt; '</span> <span class="token operator">+</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>b.html:  www.domain2.com/b.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iframe<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.domain1.com/c.html<span class="token punctuation">&quot;</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token style language-css"><span class="token property">display</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ç›‘å¬a.htmlä¼ æ¥çš„hashå€¼ï¼Œå†ä¼ ç»™c.html</span>
    window<span class="token punctuation">.</span><span class="token function-variable function">onhashchange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> iframe<span class="token punctuation">.</span>src <span class="token operator">+</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  	<span class="token comment">//onhashchange: å½“ä¸€ä¸ªçª—å£çš„hashï¼ˆurlä¸­#åé¢çš„éƒ¨åˆ†ï¼‰å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è§¦å‘çš„äº‹ä»¶</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>c.htmlï¼š(http://www.domain1.com/c.html)</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// ç›‘å¬b.htmlä¼ æ¥çš„hashå€¼</span>
    window<span class="token punctuation">.</span><span class="token function-variable function">onhashchange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å†é€šè¿‡æ“ä½œåŒåŸŸa.htmlçš„jså›è°ƒï¼Œå°†ç»“æœä¼ å›</span>
        window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">onCallback</span><span class="token punctuation">(</span><span class="token string">'hello: '</span> <span class="token operator">+</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'#user='</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>aéœ€è¦è·¨åŸŸå’Œbé€šä¿¡ï¼Œbæ˜¯açš„iframeï¼Œæœ¬æ–¹æ¡ˆåˆ›å»ºä¸€ä¸ªå’ŒaåŒåŸŸçš„cé¡µé¢ï¼Œå°†cè®¾ç½®ä¸ºbé¡µé¢ä¸­çš„iframeã€‚aå‘bé€šä¿¡ä¸éœ€è¦cé¡µé¢å‚ä¸ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡è®¾ç½®è¯¥iframeçš„srcä¸­çš„urlå‚æ•°å®ç°ï¼›bå‘aé€šä¿¡ï¼Œå°±éœ€è¦å…ˆé€šè¿‡urlå‚æ•°æŠŠæ•°æ®ä¼ ç»™cï¼Œcå†é€šè¿‡window.parent.parentè·å–aé¡µé¢çš„å…¨å±€ä½œç”¨åŸŸå¼•ç”¨ï¼ŒæŠŠéœ€è¦ä¼ é€’çš„æ•°æ®ä½œä¸ºå‚æ•°ï¼Œè°ƒç”¨å…¶ä¸­å·²ç»è®¾å®šå¥½çš„å‡½æ•°ã€‚</p> <h2 id="window-name-iframe"><a href="#window-name-iframe" class="header-anchor">#</a> window.name+iframe</h2> <p>window.nameå±æ€§åœ¨ä¸åŒåŸŸååŠ è½½åä¾ç„¶å­˜åœ¨ï¼Œè€Œä¸”nameå€¼å¯ä»¥å¾ˆé•¿ï¼ˆ2MBï¼‰</p> <p>a.htmlï¼š(http://www.domain1.com/a.html)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">proxy</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// åŠ è½½è·¨åŸŸé¡µé¢</span>
    iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>

    <span class="token comment">// onloadäº‹ä»¶ä¼šè§¦å‘2æ¬¡ï¼Œç¬¬1æ¬¡åŠ è½½è·¨åŸŸé¡µï¼Œå¹¶ç•™å­˜æ•°æ®äºwindow.name</span>
    iframe<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ç¬¬2æ¬¡onload(åŒåŸŸproxyé¡µ)æˆåŠŸåï¼Œè¯»å–åŒåŸŸwindow.nameä¸­æ•°æ®</span>
            <span class="token function">callback</span><span class="token punctuation">(</span>iframe<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">destoryFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ç¬¬1æ¬¡onload(è·¨åŸŸé¡µ)æˆåŠŸåï¼Œåˆ‡æ¢åˆ°åŒåŸŸä»£ç†é¡µé¢</span>
            iframe<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">'http://www.domain1.com/proxy.html'</span><span class="token punctuation">;</span>
            state <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è·å–æ•°æ®ä»¥åé”€æ¯è¿™ä¸ªiframeï¼Œé‡Šæ”¾å†…å­˜ï¼›è¿™ä¹Ÿä¿è¯äº†å®‰å…¨ï¼ˆä¸è¢«å…¶ä»–åŸŸframe jsè®¿é—®ï¼‰</span>
    <span class="token keyword">function</span> <span class="token function">destoryFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        iframe<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iframe<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// è¯·æ±‚è·¨åŸŸbé¡µé¢æ•°æ®</span>
<span class="token function">proxy</span><span class="token punctuation">(</span><span class="token string">'http://www.domain2.com/b.html'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>proxy.htmlï¼š(http://www.domain1.com/proxy....</p> <p>å’Œaé¡µé¢åŒåŸŸå³å¯ï¼Œä¸éœ€è¦ä»»ä½•å†…å®¹ï¼Œåªè¦æ˜¯ä¸ªé¡µé¢å°±è¡Œ</p> <p>b.htmlï¼š(http://www.domain2.com/b.html)</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    window<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'This is domain2 data!'</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>åŠ¨æ€åœ°åœ¨aé¡µé¢æ·»åŠ bé¡µé¢çš„iframeï¼Œåœ¨iframeåŠ è½½åï¼ˆè¿™æ—¶å€™bé¡µé¢è¢«åŠ è½½ï¼Œwindow.nameè¢«è®¾ç½®ä¸ºbé¡µé¢éœ€è¦ä¼ é€’çš„ä¿¡æ¯ï¼‰å°†å…¶å®šå‘è‡³ä¸aé¡µé¢åŒåŸŸçš„ä»£ç†é¡µé¢ï¼Œè¿™æ—¶å€™aå’Œä»£ç†é¡µé¢åŒåŸŸï¼Œè¯»å–iframeä¸­é¡µé¢çš„window.nameå€¼ï¼Œå¹¶ä¼ å…¥å›è°ƒã€‚æœ€åé”€æ¯è¿™ä¸ªiframeã€‚</p> <h2 id="postmessage"><a href="#postmessage" class="header-anchor">#</a> postMessage</h2> <p>HTML5 XMLHttpRequest level2çš„apiï¼Œä¸€ä¸ªå¯ä»¥è·¨åŸŸæ“ä½œçš„windowæ–¹æ³•</p> <p>a.htmlï¼š(http://www.domain1.com/a.html)</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iframe<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.domain2.com/b.html<span class="token punctuation">&quot;</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token style language-css"><span class="token property">display</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">       
    <span class="token keyword">var</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'aym'</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// å‘domain2ä¼ é€è·¨åŸŸæ•°æ®</span>
        iframe<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'http://www.domain2.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// æ¥å—domain2è¿”å›æ•°æ®</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'data from domain2 ---&gt; '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>b.htmlï¼š(http://www.domain2.com/b.html)</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// æ¥æ”¶domain1çš„æ•°æ®</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'data from domain1 ---&gt; '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">.</span>number <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

            <span class="token comment">// å¤„ç†åå†å‘å›domain1</span>
            window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'http://www.domain1.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>åŒæ–¹é¡µé¢ä½¿ç”¨postMessageå‘å¯¹æ–¹å‘é€ä¿¡æ¯ï¼Œå¹¶æ³¨å†Œäº‹ä»¶å›è°ƒç›‘å¬messageäº‹ä»¶ï¼Œæ¥æ”¶å¯¹æ–¹å‘é€çš„ä¿¡æ¯ã€‚çœ‹èµ·æ¥æ˜¯æ¯”è¾ƒä¸é”™çš„æ–¹æ³•ğŸ‘€ä¸Šé¢å‡ ä¸ªå¤šå°‘æœ‰ç‚¹hackçš„æ„æ€ã€‚</p> <h2 id="nginxåå‘ä»£ç†"><a href="#nginxåå‘ä»£ç†" class="header-anchor">#</a> Nginxåå‘ä»£ç†</h2> <h2 id="nodejsä¸­é—´ä»¶ä»£ç†"><a href="#nodejsä¸­é—´ä»¶ä»£ç†" class="header-anchor">#</a> Nodejsä¸­é—´ä»¶ä»£ç†</h2> <p>éƒ½æ˜¯é€šè¿‡å¯åŠ¨ä¸€ä¸ªä»£ç†æœåŠ¡ï¼Œæš´éœ²ä¸ç½‘é¡µåŒæºçš„æ¥å£ï¼Œå°†è®¿é—®è½¬å‘è‡³è·¨åŸŸçš„ç›®æ ‡è·¯å¾„ã€‚å› ä¸ºåŒæºç­–ç•¥æ˜¯æµè§ˆå™¨ä¸Šçš„ï¼ŒæœåŠ¡ç«¯ä¸å—é™åˆ¶ã€‚</p> <h2 id="æœ¬åœ°åå‘ä»£ç†"><a href="#æœ¬åœ°åå‘ä»£ç†" class="header-anchor">#</a> æœ¬åœ°åå‘ä»£ç†</h2> <p>vueè‡ªå¸¦ä¸€ä¸ªæœ¬åœ°åå‘ä»£ç†ï¼Œæ¥å£å’Œé¡¹ç›®éƒ½éƒ¨ç½²åœ¨åŒä¸€ä¸ªæœ¬åœ°æ¥å£ä¸Šï¼Œé…ç½®ç›®æ ‡è·¯å¾„å³å¯å®ç°æœ¬åœ°åå‘ä»£ç†ã€‚</p> <p>å…¶ä»–é¡¹ç›®æœ¬åœ°å¼€å‘æ—¶éœ€è¦ä½¿ç”¨http-proxy-middlewareæ¨¡å—ï¼Œå’Œvueè‡ªå¸¦çš„é‚£ä¸ªæ˜¯ä¸€ä¸ªæ„æ€ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/note/base/getå’Œpost.html" class="prev">
        HTTPæ–¹æ³•
      </a></span> <span class="next"><a href="/note/Fe/engine/äº‹ä»¶å¾ªç¯.html">
        äº‹ä»¶å¾ªç¯
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.e1bd6a40.js" defer></script><script src="/note/assets/js/2.928e56f7.js" defer></script><script src="/note/assets/js/74.2bf5ec9d.js" defer></script>
  </body>
</html>
