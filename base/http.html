<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP | 一个云鬼</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="我悲痛欲绝，跳进了家门口的井里">
    
    <link rel="preload" href="/note/assets/css/0.styles.ba1ec7e7.css" as="style"><link rel="preload" href="/note/assets/js/app.157265f9.js" as="script"><link rel="preload" href="/note/assets/js/2.928e56f7.js" as="script"><link rel="preload" href="/note/assets/js/72.1bdcd1be.js" as="script"><link rel="prefetch" href="/note/assets/js/10.56be0291.js"><link rel="prefetch" href="/note/assets/js/11.d00f91ee.js"><link rel="prefetch" href="/note/assets/js/12.12a6aaf0.js"><link rel="prefetch" href="/note/assets/js/13.209e7f2e.js"><link rel="prefetch" href="/note/assets/js/14.1ed1b7aa.js"><link rel="prefetch" href="/note/assets/js/15.671112c7.js"><link rel="prefetch" href="/note/assets/js/16.8263f4ae.js"><link rel="prefetch" href="/note/assets/js/17.cca69073.js"><link rel="prefetch" href="/note/assets/js/18.4d276cc6.js"><link rel="prefetch" href="/note/assets/js/19.3a5812ca.js"><link rel="prefetch" href="/note/assets/js/20.b77fc401.js"><link rel="prefetch" href="/note/assets/js/21.e5cbf099.js"><link rel="prefetch" href="/note/assets/js/22.a3c7ec1e.js"><link rel="prefetch" href="/note/assets/js/23.74a722b3.js"><link rel="prefetch" href="/note/assets/js/24.a80f9332.js"><link rel="prefetch" href="/note/assets/js/25.bce977e4.js"><link rel="prefetch" href="/note/assets/js/26.0bb56765.js"><link rel="prefetch" href="/note/assets/js/27.a798576c.js"><link rel="prefetch" href="/note/assets/js/28.0a25a569.js"><link rel="prefetch" href="/note/assets/js/29.dcdd94b0.js"><link rel="prefetch" href="/note/assets/js/3.c5b8d8dc.js"><link rel="prefetch" href="/note/assets/js/30.ef5a5ba1.js"><link rel="prefetch" href="/note/assets/js/31.7980e683.js"><link rel="prefetch" href="/note/assets/js/32.8aea73bf.js"><link rel="prefetch" href="/note/assets/js/33.9bf915b7.js"><link rel="prefetch" href="/note/assets/js/34.b7970040.js"><link rel="prefetch" href="/note/assets/js/35.4396e3a4.js"><link rel="prefetch" href="/note/assets/js/36.3fda55bc.js"><link rel="prefetch" href="/note/assets/js/37.abf3c2e8.js"><link rel="prefetch" href="/note/assets/js/38.bd1c066a.js"><link rel="prefetch" href="/note/assets/js/39.922586ba.js"><link rel="prefetch" href="/note/assets/js/4.e05c873c.js"><link rel="prefetch" href="/note/assets/js/40.69bea03d.js"><link rel="prefetch" href="/note/assets/js/41.05f9cca9.js"><link rel="prefetch" href="/note/assets/js/42.e8bac7b8.js"><link rel="prefetch" href="/note/assets/js/43.77601d40.js"><link rel="prefetch" href="/note/assets/js/44.bcab2316.js"><link rel="prefetch" href="/note/assets/js/45.cdaaab6a.js"><link rel="prefetch" href="/note/assets/js/46.ade7ce90.js"><link rel="prefetch" href="/note/assets/js/47.b1416a22.js"><link rel="prefetch" href="/note/assets/js/48.b65cc535.js"><link rel="prefetch" href="/note/assets/js/49.32564562.js"><link rel="prefetch" href="/note/assets/js/5.76fc70b2.js"><link rel="prefetch" href="/note/assets/js/50.f477f0b0.js"><link rel="prefetch" href="/note/assets/js/51.be44872d.js"><link rel="prefetch" href="/note/assets/js/52.0d8d31ad.js"><link rel="prefetch" href="/note/assets/js/53.ab4f5ed5.js"><link rel="prefetch" href="/note/assets/js/54.1e6eb8b6.js"><link rel="prefetch" href="/note/assets/js/55.19b00eac.js"><link rel="prefetch" href="/note/assets/js/56.603d7d8d.js"><link rel="prefetch" href="/note/assets/js/57.da9ac7b9.js"><link rel="prefetch" href="/note/assets/js/58.8e9dbbf4.js"><link rel="prefetch" href="/note/assets/js/59.35eb923c.js"><link rel="prefetch" href="/note/assets/js/6.498ab014.js"><link rel="prefetch" href="/note/assets/js/60.fa63999b.js"><link rel="prefetch" href="/note/assets/js/61.5df957fd.js"><link rel="prefetch" href="/note/assets/js/62.62f8f145.js"><link rel="prefetch" href="/note/assets/js/63.4952e3f1.js"><link rel="prefetch" href="/note/assets/js/64.be3ce7a3.js"><link rel="prefetch" href="/note/assets/js/65.c9f6913e.js"><link rel="prefetch" href="/note/assets/js/66.8730080c.js"><link rel="prefetch" href="/note/assets/js/67.67f6970f.js"><link rel="prefetch" href="/note/assets/js/68.e6a4f606.js"><link rel="prefetch" href="/note/assets/js/69.1e1be522.js"><link rel="prefetch" href="/note/assets/js/7.404a00b4.js"><link rel="prefetch" href="/note/assets/js/70.75301732.js"><link rel="prefetch" href="/note/assets/js/71.de99da72.js"><link rel="prefetch" href="/note/assets/js/73.73ee6eff.js"><link rel="prefetch" href="/note/assets/js/74.58bf008f.js"><link rel="prefetch" href="/note/assets/js/75.3cb76301.js"><link rel="prefetch" href="/note/assets/js/76.bc644e9b.js"><link rel="prefetch" href="/note/assets/js/77.3947a5c4.js"><link rel="prefetch" href="/note/assets/js/78.3c16b24b.js"><link rel="prefetch" href="/note/assets/js/79.9e0e5e98.js"><link rel="prefetch" href="/note/assets/js/8.bde4b07a.js"><link rel="prefetch" href="/note/assets/js/80.b8f7ef6b.js"><link rel="prefetch" href="/note/assets/js/81.53727e2d.js"><link rel="prefetch" href="/note/assets/js/82.3719231e.js"><link rel="prefetch" href="/note/assets/js/83.d548c788.js"><link rel="prefetch" href="/note/assets/js/84.1bb5532c.js"><link rel="prefetch" href="/note/assets/js/85.81984431.js"><link rel="prefetch" href="/note/assets/js/86.123a1604.js"><link rel="prefetch" href="/note/assets/js/87.bd1b241e.js"><link rel="prefetch" href="/note/assets/js/88.fff2cdc9.js"><link rel="prefetch" href="/note/assets/js/89.527b0fcc.js"><link rel="prefetch" href="/note/assets/js/9.83da0067.js"><link rel="prefetch" href="/note/assets/js/90.fb18e27d.js"><link rel="prefetch" href="/note/assets/js/91.19c3438c.js"><link rel="prefetch" href="/note/assets/js/92.86474dae.js"><link rel="prefetch" href="/note/assets/js/93.c1b143f4.js"><link rel="prefetch" href="/note/assets/js/94.91ce8408.js"><link rel="prefetch" href="/note/assets/js/95.357a654b.js"><link rel="prefetch" href="/note/assets/js/96.e1d38e27.js"><link rel="prefetch" href="/note/assets/js/97.1674c0d8.js"><link rel="prefetch" href="/note/assets/js/98.bba632ca.js"><link rel="prefetch" href="/note/assets/js/99.ee1a0f55.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.ba1ec7e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">一个云鬼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/Fe/" class="nav-link">
  Note
</a></div><div class="nav-item"><a href="/note/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/CruelPineapple" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/Fe/" class="nav-link">
  Note
</a></div><div class="nav-item"><a href="/note/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/CruelPineapple" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>红宝书笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/base/tcp拥塞.html" class="sidebar-link">TCP拥塞控制</a></li><li><a href="/note/base/34.html" class="sidebar-link">三次握手四次挥手</a></li><li><a href="/note/base/http.html" aria-current="page" class="active sidebar-link">HTTP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/base/http.html#http1-1" class="sidebar-link">HTTP1.1</a></li><li class="sidebar-sub-header"><a href="/note/base/http.html#spdy" class="sidebar-link">SPDY</a></li><li class="sidebar-sub-header"><a href="/note/base/http.html#http2" class="sidebar-link">HTTP2</a></li><li class="sidebar-sub-header"><a href="/note/base/http.html#https" class="sidebar-link">HTTPS</a></li></ul></li><li><a href="/note/base/http缓存.html" class="sidebar-link">HTTP缓存</a></li><li><a href="/note/base/url.html" class="sidebar-link">输入url后</a></li><li><a href="/note/base/get和post.html" class="sidebar-link">HTTP方法</a></li><li><a href="/note/base/跨域.html" class="sidebar-link">跨域</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>引擎</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>我不知道的JS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>方法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="http"><a href="#http" class="header-anchor">#</a> HTTP</h1> <p>基于TCP的协议，无状态的（请求之间没有关系）1.1及以前的HTTP报文都是可读的，HTTP2将报文内容嵌入二进制分帧，帮助头部压缩和复用等，不过客户端会重组二进制帧，因此看起来是一样的。</p> <p>HTTP请求报文像这样</p> <div class="language- extra-class"><pre class="language-text"><code>GET /asd/?vmid=672342685 HTTP/1.1
Host: sakurajimama1.ltd
Proxy-Connection: keep-alive
Accept: application/json, text/plain, */*
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36
Referer: http://sakurajimama1.ltd/asouldigits/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
If-None-Match: W/&quot;14-h5JqNPPusBBiwamERpUFheOmByM&quot;
</code></pre></div><p>第一行是方法，路径和协议版本，下面就是头部，GET是没有请求体的</p> <p>响应报文像这样</p> <div class="language- extra-class"><pre class="language-text"><code>HTTP/1.1 200 OK
Content-Length: 20
Connection: keep-alive
Content-Type: application/json; charset=utf-8
Date: Wed, 13 Oct 2021 12:09:41 GMT
Etag: W/&quot;14-aKoSYNdjPgyO65RMB9etOxIY/5M&quot;
Keep-Alive: timeout=4
Proxy-Connection: keep-alive
Server: nginx/1.18.0
X-Powered-By: Express
</code></pre></div><p>第一行是协议，状态码和状态信息，下面是头部</p> <h2 id="http1-1"><a href="#http1-1" class="header-anchor">#</a> HTTP1.1</h2> <p>引入更多缓存控制策略，例如上面的If-None-Match就是HTTP1.1引入的。</p> <p>优化了带宽使用，在1.0中，可能值请求了一个对象的某个部分，但是服务器把整个对象送过来了（不懂为什么会发生这种情况）。1.1引入range头部，允许只请求资源的某个部分，返回码是206</p> <p>增加了24个错误响应状态码</p> <p>能够处理Host头部，1.0认为每台服务器都有一个唯一的IP地址，因此没有传递主机名，但是随着虚拟主机的发展，一台物理服务器上可能存在多个虚拟主机，因此需要Host头部用于识别</p> <p>支持长连接和流水线，一个HTTP连接不会立刻关闭，能够进行多次请求和相应，多个请求可以连续发送（流水线发送）</p> <h2 id="spdy"><a href="#spdy" class="header-anchor">#</a> SPDY</h2> <p>谷歌提出的基于TCP的应用层协议，旨在通过压缩，多路复用和优先级来缩短网页的家在时间。SPDY意思是speedy，快！</p> <p>SPDY在HTTP之下，TCP和SSL之上。</p> <p>HTTP的不足有：单路连接，请求低效，只允许客户端主动发起请求，头部冗余（会反复发送）</p> <h3 id="spdy优点"><a href="#spdy优点" class="header-anchor">#</a> SPDY优点</h3> <p>多路复用，请求优化：一个SPDY连接内可以有无限个并行的请求，即允许多个并发HTTP请求共用一个TCP会话。另外还可以设置多路复用的优先级，而不是传统HTTP那样按照先入先出一个一个处理请求，它会选择性地先传输CSS这样的重要资源，然后传送图标等不太重要的资源</p> <p>服务器推送：服务器可以主动向客户端推送数据，例如在客户端请求CSS文件的时候就主动把该页面对应的js推送给客户端，就不需要客户端再请求了。</p> <p>压缩HTTP头部：舍弃不必要的头部信息</p> <p>强制使用SSL：更安全</p> <h2 id="http2"><a href="#http2" class="header-anchor">#</a> HTTP2</h2> <p>可以说是SPDY的升级版，区别在：</p> <p>HTTP2支持HTTP，而SPDY强制使用HTTPS</p> <p>HTTP2头部采用HPACK压缩，而SPDY采用的DEFLATE</p> <p>HPACK是一个表，为头部名设置索引，并使用索引值指代某些非常常见的头部值</p> <p>DEFLATE同时使用LZ77（一种字典编码）和哈夫曼编码，是一种无损压缩算法</p> <p>HTTP2使用了二进制格式（二进制分帧），相比HTTP1.x新增多路复用（每个请求可以随机混杂在一起，通过id分类到不同的请求），头部压缩，服务端推送（和SPDY一样的）</p> <h3 id="http2的多路复用和1-x的长连接复用区别"><a href="#http2的多路复用和1-x的长连接复用区别" class="header-anchor">#</a> HTTP2的多路复用和1.x的长连接复用区别</h3> <p>长连接是串行处理，某个任务耗时严重会影响后续任务。多路复用是并行，互不影响</p> <p>关于流水线（管道化），它要求按序发送和返回，因为HTTP报文没有序号。另外流水线可能导致队头阻塞，因此流水线一般是默认关闭的。</p> <p>HTTP2不使用流水线方式，而是使用帧，每个帧分配序号，可以乱序发送后组装。不过基于TCP的HTTP2仍然可能出现TCP的队头阻塞</p> <h3 id="tcp队头阻塞-新的性能瓶颈"><a href="#tcp队头阻塞-新的性能瓶颈" class="header-anchor">#</a> TCP队头阻塞（新的性能瓶颈）</h3> <p>因为一个分组丢失，后续分组无法按序到达接收端的时候，后续分组将被缓存直到丢失分组被重传并接收成功，这时候TCP才会将组装好的报文递交上层协议。这个问题是TCP自身机制决定的，HTTP2的多路复用无法解决，除非HTTP2使用其他底层协议。</p> <h2 id="https"><a href="#https" class="header-anchor">#</a> HTTPS</h2> <p>HTTPS并非一种新的应用层协议，只是在交付TCP协议之前经过了TLS（传输层安全性协定）/SSL（安全套接层，TLS的前身）协议的HTTP</p> <p>对称加密速度快，但是密钥来回发送容易泄露，非对称加密更安全，但是加解密速度较慢</p> <p>HTTPS混合使用对称加密和非对称加密，在明文传输的基础上加密信息，同时保证了性能</p> <h3 id="tls建立连接"><a href="#tls建立连接" class="header-anchor">#</a> TLS建立连接</h3> <ol><li>客户端发送ClientHello，包含支持的协议版本，加密算法和随机数A</li> <li>服务端返回ServerHello，证书（包含公钥），随机数B</li> <li>客户端验证证书信任链无误，产生随机数C，将其用公钥加密，发送给服务端</li> <li>服务端用私钥解密随机数C，然后根据Hello时确认的加密算法，将随机数ABC生成对称密钥。之后发送的内容都用这个密钥对称加密</li> <li>客户端也用ABC三个随机数生成同样的对称密钥，之后发送的内容用这个密钥加密</li></ol> <p>三个随机数是为了让双方都能确认对方生成随机数的能力</p> <h3 id="数字证书认证"><a href="#数字证书认证" class="header-anchor">#</a> 数字证书认证</h3> <p>证书颁布机构（CA）处于客户端和服务端都信任的立场</p> <p>服务端的申请者通过非对称加密算法（RSA）生成一对公钥和私钥，然后将申请信息（域名，组织等）和公钥一起发送给CA。CA验证申请信息无误后，生成申请信息的信息摘要（MD5，SHA），然后将信息摘要用<strong>CA自己的私钥</strong>加密，生成数字签名。</p> <p>证书包含了：</p> <ol><li><p>公钥</p></li> <li><p>证书拥有者的身份信息</p></li> <li><p>CA信息</p></li> <li><p>CA产生的数字签名和使用的算法</p></li> <li><p>有效期</p></li></ol> <h3 id="证书信任链"><a href="#证书信任链" class="header-anchor">#</a> 证书信任链</h3> <p>在加密信息摘要的时候是使用CA的私钥，解密就需要使用CA的公钥，客户端收到证书使用相同的摘要算法对证书摘要，如果摘要结果和解密的结果相同，那就说明证书没有被修改，是可以信任的。</p> <p>当然这个世界上有很多CA，（个人都能成为CA，也就是自签证书），客户端不一定认识所有的CA，如果不认识CA，它的公钥也就无从得知，也就没法解密摘要了，怎么办呢。</p> <p>答案就是<strong>证书信任链</strong></p> <p>一定能被信任的几个权威CA授权其他CA颁发中介证书，这些中介证书的数字签名就是权威CA生成的，这些中介也能继续授权中介证书，并通过自己的私钥为它们颁发的证书摘要签名。</p> <p>比如说，如果拿到了服务端发来的证书，那么证书中就会有中介的数字签名，它是中介的CA加密的，由于我不认识这个证书的CA，为了确认这张证书是可以信任的，我会通过证书中的CA信息得知中介的上级中介，直到这条证书信任链的终点</p> <p>客户端一般保存着几个权威CA的证书，也就是根证书，它们是绝对可信的。根证书的摘要签名是由权威CA的私钥加密的，而根证书内同样拥有公钥（因为它是自签名的）。</p> <p>我如果在这些权威CA的根证书中找到了刚才信任链头部的证书，我就会使用根证书的公钥解密它授权的中介证书的签名，然后和我自己用相同算法得到的摘要对比。对比通过后，接下来我就沿着信任链往回，一个一个地使用颁发者的公钥解密证书拥有者的签名并验证它，直到服务端发来的证书也被验证。</p> <p>到此，我就完成了一次证书信任链的验证，服务端发来的证书是可信的。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/base/34.html" class="prev">
        三次握手四次挥手
      </a></span> <span class="next"><a href="/note/base/http缓存.html">
        HTTP缓存
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.157265f9.js" defer></script><script src="/note/assets/js/2.928e56f7.js" defer></script><script src="/note/assets/js/72.1bdcd1be.js" defer></script>
  </body>
</html>
